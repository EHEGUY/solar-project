/* =========================================================
   app-animations.css — micro‑interactions and motion system
   Requires: standard CSS animations + transforms
   ========================================================= */

/* 1) Motion tokens */
:root{
  --ease-out: cubic-bezier(.16,1,.3,1);
  --ease-in: cubic-bezier(.32,0,.67,0);
  --ease-in-out: cubic-bezier(.65,.05,.36,1);
  --dur-1: 160ms;
  --dur-2: 260ms;
  --dur-3: 420ms;
  --dur-4: 800ms;
}

/* 2) Page intro: map and side card */
#map-wrap{
  animation: fade-up var(--dur-3) var(--ease-out) 60ms both, soft-pop var(--dur-3) var(--ease-out) 60ms both;
}
.card{
  animation: fade-up var(--dur-3) var(--ease-out) 120ms both;
}

/* 3) Header chip subtle float + glow dot pulse */
.brand{ animation: floaty 6s ease-in-out 600ms infinite; }
.brand .dot{ animation: pulse-glow 1600ms ease-in-out 400ms infinite; }

/* 4) Buttons: hover lift + shine sweep + active press */
.btn{
  position: relative;
  transition: transform var(--dur-1) var(--ease-out), filter var(--dur-1) var(--ease-out), box-shadow var(--dur-1) var(--ease-out);
  will-change: transform, filter;
}
.btn:hover{ transform: translateY(-2px) scale(1.01); filter: brightness(1.03) saturate(1.08); }
.btn:active{ transform: translateY(0) scale(.99); transition-duration: 80ms; }
.btn::before{
  content:""; position:absolute; inset:0; border-radius: inherit;
  background: linear-gradient(120deg, rgba(255,255,255,.0) 0%, rgba(255,255,255,.35) 40%, rgba(255,255,255,.0) 60%);
  transform: translateX(-120%); filter: blur(6px); pointer-events:none;
}
.btn:hover::before{ animation: shine-sweep 900ms var(--ease-out); }

/* 5) KPI chips: gentle rise on update (toggle .is-updated) */
.chip{ transition: transform var(--dur-1) var(--ease-out), background-color var(--dur-1) var(--ease-out); }
.chip.is-updated{ transform: translateY(-2px); background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); }

/* 6) Compass arrow: spin-on-update (toggle .spin) */
#arrow{ transition: transform var(--dur-2) var(--ease-in-out); }
#arrow.spin{ animation: spin-oneshot 600ms var(--ease-out) both; }

/* 7) Toast: pop-in handled by .show class; add sparkle flare */
.toast.show{ animation: pop-in var(--dur-2) var(--ease-out) both; }
.toast.show::after{
  content:""; position:absolute; right:-6px; top:-6px; width:10px; height:10px; border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.0) 70%);
  filter: blur(.6px); animation: twinkle 1200ms ease-in-out infinite;
}

/* 8) Leaflet controls: micro hover */
.leaflet-control-zoom a{
  transition: transform var(--dur-1) var(--ease-out), box-shadow var(--dur-1) var(--ease-out), background-color var(--dur-1) var(--ease-out);
}
.leaflet-control-zoom a:hover{ transform: translateY(-1px); box-shadow: 0 6px 14px rgba(0,0,0,.18); }

/* 9) Marker entrance and pulse (toggle classes from JS after addTo) */
.leaflet-marker-icon.bounce{ animation: marker-bounce 760ms var(--ease-out) both; }
.leaflet-marker-icon.pulse{ animation: marker-pulse 1400ms ease-out 200ms infinite; }

/* 10) Loading shimmer helper (wrap any block with .skeleton) */
.skeleton{
  position: relative; overflow: hidden; color: transparent !important;
  background: linear-gradient(90deg, rgba(255,255,255,.06) 25%, rgba(255,255,255,.16) 37%, rgba(255,255,255,.06) 63%);
  background-size: 400% 100%;
  animation: shimmer 1200ms linear infinite;
}
.skeleton::selection{ background: transparent; }

/* 11) Map focus ring on keyboard nav */
#map:focus-visible{
  outline: 3px solid color-mix(in srgb, #3b82f6 70%, transparent);
  outline-offset: 2px;
  animation: focus-pulse 1000ms ease-in-out 2;
}

/* ---------- Keyframes ---------- */

@keyframes fade-up{
  from{ opacity:0; transform: translateY(10px) scale(.98); }
  to{ opacity:1; transform: none; }
}

@keyframes soft-pop{
  0%{ transform: scale(.98); }
  60%{ transform: scale(1.008); }
  100%{ transform: scale(1); }
}

@keyframes floaty{
  0%,100%{ transform: translateY(0px); }
  50%{ transform: translateY(-4px); }
}

@keyframes pulse-glow{
  0%,100%{ box-shadow: 0 0 0 0 rgba(106,163,255,.0), 0 0 12px rgba(106,163,255,.6); }
  50%{ box-shadow: 0 0 0 10px rgba(106,163,255,.08), 0 0 18px rgba(106,163,255,.9); }
}

@keyframes shine-sweep{
  0%{ transform: translateX(-120%); opacity:.0; }
  30%{ opacity:.8; }
  100%{ transform: translateX(120%); opacity:0; }
}

@keyframes spin-oneshot{
  from{ transform: rotate(0deg); }
  to{ transform: rotate(360deg); }
}

@keyframes pop-in{
  from{ transform: translateY(8px) scale(.98); opacity:0; }
  to{ transform: none; opacity:1; }
}

@keyframes twinkle{
  0%,100%{ transform: scale(.6); opacity:.4; }
  50%{ transform: scale(1.2); opacity:1; }
}

@keyframes marker-bounce{
  0%{ transform: translateY(-14px) scale(.96); filter: drop-shadow(0 14px 20px rgba(0,0,0,.2)); }
  60%{ transform: translateY(2px) scale(1.02); }
  80%{ transform: translateY(-2px) scale(.998); }
  100%{ transform: translateY(0) scale(1); filter: drop-shadow(0 10px 18px rgba(0,0,0,.16)); }
}

@keyframes marker-pulse{
  0%{ filter: drop-shadow(0 0 0 rgba(99,102,241,.0)); transform: translateY(0) }
  50%{ filter: drop-shadow(0 0 12px rgba(99,102,241,.6)); transform: translateY(-1px) }
  100%{ filter: drop-shadow(0 0 0 rgba(99,102,241,.0)); transform: translateY(0) }
}

@keyframes shimmer{
  0%{ background-position: 100% 0; }
  100%{ background-position: 0 0; }
}

@keyframes focus-pulse{
  0%{ outline-color: color-mix(in srgb, #3b82f6 70%, transparent); }
  50%{ outline-color: color-mix(in srgb, #22d3ee 70%, transparent); }
  100%{ outline-color: color-mix(in srgb, #3b82f6 70%, transparent); }
}

/* ---------- Reduced motion accessibility ---------- */
/* Respect user preference to reduce or remove motion */
@media (prefers-reduced-motion: reduce){
  *{
    animation-duration: 1ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 1ms !important;
  }
}
